name: Build e Publicar ExtensÃ£o

on:
  push:
    branches:
      - main

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Baixar cÃ³digo
        uses: actions/checkout@v3

      - name: ðŸ›  Configurar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ðŸ“¦ Instalar dependÃªncias
        run: npm install chrome-webstore-upload node-fetch

      - name: ðŸ”¼ Atualizar versÃ£o do manifest
        run: node bump-version.js

      - name: ðŸ—œ Criar pacote .zip
        run: zip -r minha-extensao.zip . -x ".git/*" ".github/*" "node_modules/*"

      - name: ðŸš€ Publicar na Chrome Web Store
        run: node deploy-monitor.js
        env:
          EXTENSION_ID: ${{ secrets.EXTENSION_ID }}
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          REFRESH_TOKEN: ${{ secrets.REFRESH_TOKEN }}
          ZIP_FILE: './minha-extensao.zip'
